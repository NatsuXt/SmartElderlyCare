# SQL文件夹说明文档

## 📁 文件夹用途
此文件夹包含智慧养老系统房间设备管理模块的所有数据库相关SQL脚本，用于在Oracle 18c数据库中创建和管理系统所需的表结构、索引、序列、触发器等数据库对象。

## 🗃️ 数据库连接信息
- **服务器地址**: 47.96.238.102:1521/orcl
- **用户名**: FIBRE
- **密码**: FIBRE2025
- **数据库类型**: Oracle 18c

## 📋 文件列表与说明

### 🚀 推荐执行文件（修复版本）
这些文件经过优化，解决了字符编码和语法兼容性问题：

| 文件名 | 用途 | 执行顺序 | 说明 |
|-------|------|---------|------|
| `Step2a_CreateRoomTable_Fixed.sql` | 创建房间管理表 | 1 | 房间基础信息表，无外键依赖 |
| `Step2b_CreateElderlyTable_Fixed.sql` | 创建老人信息表 | 2 | 老人基础信息表，无外键依赖 |
| `Step2c_CreateDeviceTable_Fixed.sql` | 创建设备状态表 | 3 | 设备管理表，无外键依赖 |
| `Step2e_CreateFenceTable_Fixed.sql` | 创建电子围栏表 | 4 | 围栏信息表，无外键依赖 |
| `Step2d_CreateHealthTable_Fixed.sql` | 创建健康监测表 | 5 | 健康数据表，依赖老人信息表 |
| `Step2f_CreateFenceLogTable_Fixed.sql` | 创建围栏日志表 | 6 | 围栏记录表，依赖老人和围栏表 |
| `Step4_CreateSequencesAndIndexes.sql` | 创建序列和索引 | 7 | 提升数据库性能 |
| `Step5_CreateTriggers.sql` | 创建触发器 | 8 | 自动更新时间戳 |
| `Step6_Verify.sql` | 验证创建结果 | 9 | 检查所有对象创建状态 |
| `TestData_Fixed.sql` | 插入测试数据 | 10 | 插入示例数据用于测试 |

### 🔧 辅助文件
| 文件名 | 用途 | 说明 |
|-------|------|------|
| `ExecutionGuide_Fixed.txt` | 执行指南 | 详细的执行步骤和顺序说明 |
| `CheckExistingObjects.sql` | 检查现有对象 | 查看数据库中已存在的表和序列 |
| `Step1_Cleanup_Simple.sql` | 简化清理脚本 | 删除现有表和序列（如需要） |
| `Step1_Cleanup_Manual.sql` | 手动清理脚本 | 逐条执行的清理命令 |

### 📚 原始文件（可能有兼容性问题）
| 文件名 | 用途 | 状态 |
|-------|------|------|
| `CreateTables.sql` | 完整创建脚本 | ⚠️ 可能有连接问题 |
| `CreateTables_Optimized.sql` | 优化版本 | ⚠️ 可能有编码问题 |
| `Step2_CreateBaseTables.sql` | 基础表创建 | ⚠️ 有语法错误 |
| `Step2_CreateBaseTables_EN.sql` | 英文版本 | ✅ 可用但包含6个表 |

## 🎯 数据库表结构

### 核心表（6个）
1. **RoomManagement** - 房间管理表
   - 字段：房间ID、房间号、类型、容量、状态、收费标准等
   
2. **ElderlyInfo** - 老人基本信息表
   - 字段：老人ID、姓名、性别、出生日期、身份证号等
   
3. **DeviceStatus** - 设备状态表
   - 字段：设备ID、设备名称、类型、状态、位置等
   
4. **HealthMonitoring** - 健康监测记录表
   - 字段：监测ID、老人ID、心率、血压、体温等
   - 外键：elderly_id → ElderlyInfo.elderly_id
   
5. **ElectronicFence** - 电子围栏信息表
   - 字段：围栏ID、区域定义、名称、类型、状态等
   
6. **FenceLog** - 电子围栏出入记录表
   - 字段：事件ID、老人ID、围栏ID、进入时间、离开时间等
   - 外键：elderly_id → ElderlyInfo.elderly_id, fence_id → ElectronicFence.fence_id

### 辅助对象
- **序列（6个）**: seq_room_id, seq_elderly_id, seq_device_id, seq_health_id, seq_fence_id, seq_log_id
- **索引（15个）**: 提升查询性能的索引
- **触发器（4个）**: 自动更新时间戳的触发器

## 🏃‍♂️ 快速开始

### 方案1：全新安装（推荐）
```sql
-- 按顺序执行以下文件：
@Step2a_CreateRoomTable_Fixed.sql
@Step2b_CreateElderlyTable_Fixed.sql
@Step2c_CreateDeviceTable_Fixed.sql
@Step2e_CreateFenceTable_Fixed.sql
@Step2d_CreateHealthTable_Fixed.sql
@Step2f_CreateFenceLogTable_Fixed.sql
@Step4_CreateSequencesAndIndexes.sql
@Step5_CreateTriggers.sql
@Step6_Verify.sql
@TestData_Fixed.sql
```

### 方案2：检查后安装
```sql
-- 1. 检查现有对象
@CheckExistingObjects.sql

-- 2. 如需清理（可选）
@Step1_Cleanup_Simple.sql

-- 3. 然后按方案1执行
```

## ⚠️ 注意事项

1. **执行顺序很重要**：必须先创建基础表，再创建带外键的表
2. **字符编码**：推荐使用UTF-8编码的SQL客户端
3. **SQL客户端**：推荐使用Oracle SQL Developer
4. **错误处理**：如遇到错误，先解决再继续执行后续步骤
5. **状态值**：数据库中使用英文状态值，应用程序中显示中文

## 🔄 状态值映射

| 中文 | 英文 | 用途 |
|------|------|------|
| 空闲 | Available | 房间状态 |
| 已入住 | Occupied | 房间状态 |
| 维护中 | Maintenance | 房间/设备/围栏状态 |
| 清洁中 | Cleaning | 房间状态 |
| 正常 | Normal | 设备/健康状态 |
| 故障 | Fault | 设备状态 |
| 异常 | Abnormal | 健康状态 |
| 危险 | Critical | 健康状态 |
| 启用 | Enabled | 围栏状态 |
| 禁用 | Disabled | 围栏状态 |


